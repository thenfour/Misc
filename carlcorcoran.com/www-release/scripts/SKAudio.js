var SK=SK||{};SK.__globalAudio=null,SK.Audio=function(e,t,n,r){SK.__globalAudio=this,this.storageEngine=e,this.mediaControls=t,$("#"+t.playElementID).click(function(){SK.__globalAudio.Play()}),$("#"+t.pauseElementID).click(function(){SK.__globalAudio.Pause()}),$("#"+t.previousSongElementID).click(function(){SK.__globalAudio.PreviousSong()}),$("#"+t.nextSongElementID).click(function(){SK.__globalAudio.NextSong()}),this.audioElement=document.createElement("audio"),document.getElementById(t.playElementID).appendChild(this.audioElement),$(this.audioElement).on("ended",function(){SK.__globalAudio.NextSong()}),$(this.audioElement).on("loadedmetadata",function(){SK.__globalAudio.OnPlay()}),$("#"+this.mediaControls.playElementID).css("display","inline-block"),$("#"+this.mediaControls.pauseElementID).css("display","none"),this.currentSong=this.storageEngine.GetOpeningSong(),this.CueAudio(),setTimeout(function(){n?SK.__globalAudio.Play():SK.__globalAudio.Pause()},r)},SK.Audio.prototype.OnPlay=function(){this.currentSong.StartAt&&(this.audioElement.currentTime=this.currentSong.StartAt)},SK.Audio.prototype.CueAudio=function(){if(!this.currentSong)return;if(!this.audioElement)return;$("#"+this.mediaControls.songNameElementID).text(this.currentSong.Title),this.audioElement.pause(),this.audioElement.innerHTML="";var e=document.createElement("source");this.audioElement.canPlayType("audio/mpeg")?(e.type="audio/mpeg",e.src=this.currentSong.UrlMP3):(e.type="audio/ogg",e.src=this.currentSong.UrlOGG),this.audioElement.appendChild(e),this.audioElement.load()},SK.Audio.prototype.Play=function(){if(!this.audioElement)return;this.audioElement.play(),$("#"+this.mediaControls.playElementID).css("display","none"),$("#"+this.mediaControls.pauseElementID).css("display","inline-block")},SK.Audio.prototype.Pause=function(){if(!this.audioElement)return;this.audioElement.pause(),$("#"+this.mediaControls.playElementID).css("display","inline-block"),$("#"+this.mediaControls.pauseElementID).css("display","none")},SK.Audio.prototype.PreviousSong=function(){if(!this.audioElement)return;this.currentSong=this.storageEngine.GetPreviousSong(this.currentSong),this.CueAudio(),this.Play()},SK.Audio.prototype.NextSong=function(){if(!this.audioElement)return;this.currentSong=this.storageEngine.GetNextSong(this.currentSong),this.CueAudio(),this.Play()},SK.Audio.prototype.getCurrentSongPosition=function(){return this.audioElement?this.audioElement.currentTime:0};